{-# LANGUAGE DataKinds #-}
{-# LANGUAGE TypeApplications #-}
{-# LANGUAGE ScopedTypeVariables #-}
{-# LANGUAGE FlexibleContexts #-}

-- | A JSContext is a JavaScript execution environment. All JavaScript execution takes place within a context, and all JavaScript values are tied to a context.
--
-- Generated bindings for @JSContext@.
module ObjC.JavaScriptCore.JSContext
  ( JSContext
  , IsJSContext(..)
  , init_
  , initWithVirtualMachine
  , evaluateScript
  , evaluateScript_withSourceURL
  , currentContext
  , currentCallee
  , currentThis
  , currentArguments
  , contextWithJSGlobalContextRef
  , objectForKeyedSubscript
  , setObject_forKeyedSubscript
  , globalObject
  , exception
  , setException
  , exceptionHandler
  , setExceptionHandler
  , virtualMachine
  , name
  , setName
  , inspectable
  , setInspectable
  , jsGlobalContextRef
  , contextWithJSGlobalContextRefSelector
  , currentArgumentsSelector
  , currentCalleeSelector
  , currentContextSelector
  , currentThisSelector
  , evaluateScriptSelector
  , evaluateScript_withSourceURLSelector
  , exceptionHandlerSelector
  , exceptionSelector
  , globalObjectSelector
  , initSelector
  , initWithVirtualMachineSelector
  , inspectableSelector
  , jsGlobalContextRefSelector
  , nameSelector
  , objectForKeyedSubscriptSelector
  , setExceptionHandlerSelector
  , setExceptionSelector
  , setInspectableSelector
  , setNameSelector
  , setObject_forKeyedSubscriptSelector
  , virtualMachineSelector


  ) where

import Foreign.Ptr (Ptr, FunPtr)
import Foreign.C.Types

import ObjC.Runtime.Types
import ObjC.Runtime.Message (sendMessage, sendOwnedMessage, sendClassMessage, sendOwnedClassMessage)
import ObjC.Runtime.Selector (mkSelector)
import ObjC.Runtime.Class (getRequiredClass)

import ObjC.JavaScriptCore.Internal.Classes
import ObjC.Foundation.Internal.Classes

-- | Creating New JSContexts
--
-- Create a JSContext.
--
-- Returns: The new context.
--
-- ObjC selector: @- init@
init_ :: IsJSContext jsContext => jsContext -> IO (Id JSContext)
init_ jsContext =
  sendOwnedMessage jsContext initSelector

-- | Create a JSContext in the specified virtual machine.
--
-- @virtualMachine@ — The JSVirtualMachine in which the context will be created.
--
-- Returns: The new context.
--
-- ObjC selector: @- initWithVirtualMachine:@
initWithVirtualMachine :: (IsJSContext jsContext, IsJSVirtualMachine virtualMachine) => jsContext -> virtualMachine -> IO (Id JSContext)
initWithVirtualMachine jsContext virtualMachine =
  sendOwnedMessage jsContext initWithVirtualMachineSelector (toJSVirtualMachine virtualMachine)

-- | Evaluating Scripts
--
-- Evaluate a string of JavaScript code.
--
-- @script@ — A string containing the JavaScript code to evaluate.
--
-- Returns: The last value generated by the script.
--
-- ObjC selector: @- evaluateScript:@
evaluateScript :: (IsJSContext jsContext, IsNSString script) => jsContext -> script -> IO (Id JSValue)
evaluateScript jsContext script =
  sendMessage jsContext evaluateScriptSelector (toNSString script)

-- | Evaluate a string of JavaScript code, with a URL for the script's source file.
--
-- @script@ — A string containing the JavaScript code to evaluate.
--
-- @sourceURL@ — A URL for the script's source file. Used by debuggers and when reporting exceptions. This parameter is informative only: it does not change the behavior of the script.
--
-- Returns: The last value generated by the script.
--
-- ObjC selector: @- evaluateScript:withSourceURL:@
evaluateScript_withSourceURL :: (IsJSContext jsContext, IsNSString script, IsNSURL sourceURL) => jsContext -> script -> sourceURL -> IO (Id JSValue)
evaluateScript_withSourceURL jsContext script sourceURL =
  sendMessage jsContext evaluateScript_withSourceURLSelector (toNSString script) (toNSURL sourceURL)

-- | Callback Accessors
--
-- Get the JSContext that is currently executing.
--
-- This method may be called from within an Objective-C block or method invoked as a callback from JavaScript to retrieve the callback's context. Outside of a callback from JavaScript this method will return nil.
--
-- Returns: The currently executing JSContext or nil if there isn't one.
--
-- ObjC selector: @+ currentContext@
currentContext :: IO (Id JSContext)
currentContext  =
  do
    cls' <- getRequiredClass "JSContext"
    sendClassMessage cls' currentContextSelector

-- | Get the JavaScript function that is currently executing.
--
-- This method may be called from within an Objective-C block or method invoked as a callback from JavaScript to retrieve the callback's context. Outside of a callback from JavaScript this method will return nil.
--
-- Returns: The currently executing JavaScript function or nil if there isn't one.
--
-- ObjC selector: @+ currentCallee@
currentCallee :: IO (Id JSValue)
currentCallee  =
  do
    cls' <- getRequiredClass "JSContext"
    sendClassMessage cls' currentCalleeSelector

-- | Get the this value of the currently executing method.
--
-- This method may be called from within an Objective-C block or method invoked as a callback from JavaScript to retrieve the callback's this value. Outside of a callback from JavaScript this method will return nil.
--
-- Returns: The current this value or nil if there isn't one.
--
-- ObjC selector: @+ currentThis@
currentThis :: IO (Id JSValue)
currentThis  =
  do
    cls' <- getRequiredClass "JSContext"
    sendClassMessage cls' currentThisSelector

-- | Get the arguments to the current callback.
--
-- This method may be called from within an Objective-C block or method invoked as a callback from JavaScript to retrieve the callback's arguments, objects in the returned array are instances of JSValue. Outside of a callback from JavaScript this method will return nil.
--
-- Returns: An NSArray of the arguments nil if there is no current callback.
--
-- ObjC selector: @+ currentArguments@
currentArguments :: IO (Id NSArray)
currentArguments  =
  do
    cls' <- getRequiredClass "JSContext"
    sendClassMessage cls' currentArgumentsSelector

-- | Create a JSContext, wrapping its C API counterpart.
--
-- Returns: The JSContext equivalent of the provided JSGlobalContextRef.
--
-- ObjC selector: @+ contextWithJSGlobalContextRef:@
contextWithJSGlobalContextRef :: Ptr () -> IO (Id JSContext)
contextWithJSGlobalContextRef jsGlobalContextRef =
  do
    cls' <- getRequiredClass "JSContext"
    sendClassMessage cls' contextWithJSGlobalContextRefSelector jsGlobalContextRef

-- | Get a particular property on the global object.
--
-- Returns: The JSValue for the global object's property.
--
-- ObjC selector: @- objectForKeyedSubscript:@
objectForKeyedSubscript :: IsJSContext jsContext => jsContext -> RawId -> IO (Id JSValue)
objectForKeyedSubscript jsContext key =
  sendMessage jsContext objectForKeyedSubscriptSelector key

-- | Set a particular property on the global object.
--
-- ObjC selector: @- setObject:forKeyedSubscript:@
setObject_forKeyedSubscript :: (IsJSContext jsContext, IsNSObject key) => jsContext -> RawId -> key -> IO ()
setObject_forKeyedSubscript jsContext object key =
  sendMessage jsContext setObject_forKeyedSubscriptSelector object (toNSObject key)

-- | Get the global object of the context.
--
-- This method retrieves the global object of the JavaScript execution context. Instances of JSContext originating from WebKit will return a reference to the WindowProxy object.
--
-- Returns: The global object.
--
-- ObjC selector: @- globalObject@
globalObject :: IsJSContext jsContext => jsContext -> IO (Id JSValue)
globalObject jsContext =
  sendMessage jsContext globalObjectSelector

-- | The exception property may be used to throw an exception to JavaScript.
--
-- Before a callback is made from JavaScript to an Objective-C block or method, the prior value of the exception property will be preserved and the property will be set to nil. After the callback has completed the new value of the exception property will be read, and prior value restored. If the new value of exception is not nil, the callback will result in that value being thrown.
--
-- This property may also be used to check for uncaught exceptions arising from API function calls (since the default behaviour of exceptionHandler is to assign an uncaught exception to this property).
--
-- ObjC selector: @- exception@
exception :: IsJSContext jsContext => jsContext -> IO (Id JSValue)
exception jsContext =
  sendMessage jsContext exceptionSelector

-- | The exception property may be used to throw an exception to JavaScript.
--
-- Before a callback is made from JavaScript to an Objective-C block or method, the prior value of the exception property will be preserved and the property will be set to nil. After the callback has completed the new value of the exception property will be read, and prior value restored. If the new value of exception is not nil, the callback will result in that value being thrown.
--
-- This property may also be used to check for uncaught exceptions arising from API function calls (since the default behaviour of exceptionHandler is to assign an uncaught exception to this property).
--
-- ObjC selector: @- setException:@
setException :: (IsJSContext jsContext, IsJSValue value) => jsContext -> value -> IO ()
setException jsContext value =
  sendMessage jsContext setExceptionSelector (toJSValue value)

-- | If a call to an API function results in an uncaught JavaScript exception, the exceptionHandler block will be invoked. The default implementation for the exception handler will store the exception to the exception property on context. As a consequence the default behaviour is for uncaught exceptions occurring within a callback from JavaScript to be rethrown upon return. Setting this value to nil will cause all exceptions occurring within a callback from JavaScript to be silently caught.
--
-- ObjC selector: @- exceptionHandler@
exceptionHandler :: IsJSContext jsContext => jsContext -> IO (Ptr ())
exceptionHandler jsContext =
  sendMessage jsContext exceptionHandlerSelector

-- | If a call to an API function results in an uncaught JavaScript exception, the exceptionHandler block will be invoked. The default implementation for the exception handler will store the exception to the exception property on context. As a consequence the default behaviour is for uncaught exceptions occurring within a callback from JavaScript to be rethrown upon return. Setting this value to nil will cause all exceptions occurring within a callback from JavaScript to be silently caught.
--
-- ObjC selector: @- setExceptionHandler:@
setExceptionHandler :: IsJSContext jsContext => jsContext -> Ptr () -> IO ()
setExceptionHandler jsContext value =
  sendMessage jsContext setExceptionHandlerSelector value

-- | All instances of JSContext are associated with a JSVirtualMachine.
--
-- ObjC selector: @- virtualMachine@
virtualMachine :: IsJSContext jsContext => jsContext -> IO (Id JSVirtualMachine)
virtualMachine jsContext =
  sendMessage jsContext virtualMachineSelector

-- | Name of the JSContext. Exposed when inspecting the context.
--
-- ObjC selector: @- name@
name :: IsJSContext jsContext => jsContext -> IO (Id NSString)
name jsContext =
  sendMessage jsContext nameSelector

-- | Name of the JSContext. Exposed when inspecting the context.
--
-- ObjC selector: @- setName:@
setName :: (IsJSContext jsContext, IsNSString value) => jsContext -> value -> IO ()
setName jsContext value =
  sendMessage jsContext setNameSelector (toNSString value)

-- | Controls whether this
--
-- JSContext
--
-- is inspectable in Web Inspector. The default value is NO.
--
-- ObjC selector: @- inspectable@
inspectable :: IsJSContext jsContext => jsContext -> IO Bool
inspectable jsContext =
  sendMessage jsContext inspectableSelector

-- | Controls whether this
--
-- JSContext
--
-- is inspectable in Web Inspector. The default value is NO.
--
-- ObjC selector: @- setInspectable:@
setInspectable :: IsJSContext jsContext => jsContext -> Bool -> IO ()
setInspectable jsContext value =
  sendMessage jsContext setInspectableSelector value

-- | Get the C API counterpart wrapped by a JSContext.
--
-- Returns: The C API equivalent of this JSContext.
--
-- ObjC selector: @- JSGlobalContextRef@
jsGlobalContextRef :: IsJSContext jsContext => jsContext -> IO (Ptr ())
jsGlobalContextRef jsContext =
  sendMessage jsContext jsGlobalContextRefSelector

-- ---------------------------------------------------------------------------
-- Selectors
-- ---------------------------------------------------------------------------

-- | @Selector@ for @init@
initSelector :: Selector '[] (Id JSContext)
initSelector = mkSelector "init"

-- | @Selector@ for @initWithVirtualMachine:@
initWithVirtualMachineSelector :: Selector '[Id JSVirtualMachine] (Id JSContext)
initWithVirtualMachineSelector = mkSelector "initWithVirtualMachine:"

-- | @Selector@ for @evaluateScript:@
evaluateScriptSelector :: Selector '[Id NSString] (Id JSValue)
evaluateScriptSelector = mkSelector "evaluateScript:"

-- | @Selector@ for @evaluateScript:withSourceURL:@
evaluateScript_withSourceURLSelector :: Selector '[Id NSString, Id NSURL] (Id JSValue)
evaluateScript_withSourceURLSelector = mkSelector "evaluateScript:withSourceURL:"

-- | @Selector@ for @currentContext@
currentContextSelector :: Selector '[] (Id JSContext)
currentContextSelector = mkSelector "currentContext"

-- | @Selector@ for @currentCallee@
currentCalleeSelector :: Selector '[] (Id JSValue)
currentCalleeSelector = mkSelector "currentCallee"

-- | @Selector@ for @currentThis@
currentThisSelector :: Selector '[] (Id JSValue)
currentThisSelector = mkSelector "currentThis"

-- | @Selector@ for @currentArguments@
currentArgumentsSelector :: Selector '[] (Id NSArray)
currentArgumentsSelector = mkSelector "currentArguments"

-- | @Selector@ for @contextWithJSGlobalContextRef:@
contextWithJSGlobalContextRefSelector :: Selector '[Ptr ()] (Id JSContext)
contextWithJSGlobalContextRefSelector = mkSelector "contextWithJSGlobalContextRef:"

-- | @Selector@ for @objectForKeyedSubscript:@
objectForKeyedSubscriptSelector :: Selector '[RawId] (Id JSValue)
objectForKeyedSubscriptSelector = mkSelector "objectForKeyedSubscript:"

-- | @Selector@ for @setObject:forKeyedSubscript:@
setObject_forKeyedSubscriptSelector :: Selector '[RawId, Id NSObject] ()
setObject_forKeyedSubscriptSelector = mkSelector "setObject:forKeyedSubscript:"

-- | @Selector@ for @globalObject@
globalObjectSelector :: Selector '[] (Id JSValue)
globalObjectSelector = mkSelector "globalObject"

-- | @Selector@ for @exception@
exceptionSelector :: Selector '[] (Id JSValue)
exceptionSelector = mkSelector "exception"

-- | @Selector@ for @setException:@
setExceptionSelector :: Selector '[Id JSValue] ()
setExceptionSelector = mkSelector "setException:"

-- | @Selector@ for @exceptionHandler@
exceptionHandlerSelector :: Selector '[] (Ptr ())
exceptionHandlerSelector = mkSelector "exceptionHandler"

-- | @Selector@ for @setExceptionHandler:@
setExceptionHandlerSelector :: Selector '[Ptr ()] ()
setExceptionHandlerSelector = mkSelector "setExceptionHandler:"

-- | @Selector@ for @virtualMachine@
virtualMachineSelector :: Selector '[] (Id JSVirtualMachine)
virtualMachineSelector = mkSelector "virtualMachine"

-- | @Selector@ for @name@
nameSelector :: Selector '[] (Id NSString)
nameSelector = mkSelector "name"

-- | @Selector@ for @setName:@
setNameSelector :: Selector '[Id NSString] ()
setNameSelector = mkSelector "setName:"

-- | @Selector@ for @inspectable@
inspectableSelector :: Selector '[] Bool
inspectableSelector = mkSelector "inspectable"

-- | @Selector@ for @setInspectable:@
setInspectableSelector :: Selector '[Bool] ()
setInspectableSelector = mkSelector "setInspectable:"

-- | @Selector@ for @JSGlobalContextRef@
jsGlobalContextRefSelector :: Selector '[] (Ptr ())
jsGlobalContextRefSelector = mkSelector "JSGlobalContextRef"

