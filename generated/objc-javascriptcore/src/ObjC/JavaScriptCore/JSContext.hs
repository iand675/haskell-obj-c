{-# LANGUAGE TypeApplications #-}
{-# LANGUAGE ScopedTypeVariables #-}
{-# LANGUAGE FlexibleContexts #-}

-- | A JSContext is a JavaScript execution environment. All JavaScript execution takes place within a context, and all JavaScript values are tied to a context.
--
-- Generated bindings for @JSContext@.
module ObjC.JavaScriptCore.JSContext
  ( JSContext
  , IsJSContext(..)
  , init_
  , initWithVirtualMachine
  , evaluateScript
  , evaluateScript_withSourceURL
  , currentContext
  , currentCallee
  , currentThis
  , currentArguments
  , contextWithJSGlobalContextRef
  , objectForKeyedSubscript
  , setObject_forKeyedSubscript
  , globalObject
  , exception
  , setException
  , exceptionHandler
  , setExceptionHandler
  , virtualMachine
  , name
  , setName
  , inspectable
  , setInspectable
  , jsGlobalContextRef
  , initSelector
  , initWithVirtualMachineSelector
  , evaluateScriptSelector
  , evaluateScript_withSourceURLSelector
  , currentContextSelector
  , currentCalleeSelector
  , currentThisSelector
  , currentArgumentsSelector
  , contextWithJSGlobalContextRefSelector
  , objectForKeyedSubscriptSelector
  , setObject_forKeyedSubscriptSelector
  , globalObjectSelector
  , exceptionSelector
  , setExceptionSelector
  , exceptionHandlerSelector
  , setExceptionHandlerSelector
  , virtualMachineSelector
  , nameSelector
  , setNameSelector
  , inspectableSelector
  , setInspectableSelector
  , jsGlobalContextRefSelector


  ) where

import Foreign.Ptr (Ptr, nullPtr, castPtr)
import Foreign.LibFFI
import Foreign.C.Types
import Data.Int (Int8, Int16)
import Data.Word (Word16)
import Data.Coerce (coerce)

import ObjC.Runtime.Types
import ObjC.Runtime.MsgSend (sendMsg, sendClassMsg)
import ObjC.Runtime.Selector (mkSelector)
import ObjC.Runtime.Class (getRequiredClass)

import ObjC.JavaScriptCore.Internal.Classes
import ObjC.Foundation.Internal.Classes

-- | Creating New JSContexts
--
-- Create a JSContext.
--
-- Returns: The new context.
--
-- ObjC selector: @- init@
init_ :: IsJSContext jsContext => jsContext -> IO (Id JSContext)
init_ jsContext  =
  sendMsg jsContext (mkSelector "init") (retPtr retVoid) [] >>= ownedObject . castPtr

-- | Create a JSContext in the specified virtual machine.
--
-- @virtualMachine@ — The JSVirtualMachine in which the context will be created.
--
-- Returns: The new context.
--
-- ObjC selector: @- initWithVirtualMachine:@
initWithVirtualMachine :: (IsJSContext jsContext, IsJSVirtualMachine virtualMachine) => jsContext -> virtualMachine -> IO (Id JSContext)
initWithVirtualMachine jsContext  virtualMachine =
withObjCPtr virtualMachine $ \raw_virtualMachine ->
    sendMsg jsContext (mkSelector "initWithVirtualMachine:") (retPtr retVoid) [argPtr (castPtr raw_virtualMachine :: Ptr ())] >>= ownedObject . castPtr

-- | Evaluating Scripts
--
-- Evaluate a string of JavaScript code.
--
-- @script@ — A string containing the JavaScript code to evaluate.
--
-- Returns: The last value generated by the script.
--
-- ObjC selector: @- evaluateScript:@
evaluateScript :: (IsJSContext jsContext, IsNSString script) => jsContext -> script -> IO (Id JSValue)
evaluateScript jsContext  script =
withObjCPtr script $ \raw_script ->
    sendMsg jsContext (mkSelector "evaluateScript:") (retPtr retVoid) [argPtr (castPtr raw_script :: Ptr ())] >>= retainedObject . castPtr

-- | Evaluate a string of JavaScript code, with a URL for the script's source file.
--
-- @script@ — A string containing the JavaScript code to evaluate.
--
-- @sourceURL@ — A URL for the script's source file. Used by debuggers and when reporting exceptions. This parameter is informative only: it does not change the behavior of the script.
--
-- Returns: The last value generated by the script.
--
-- ObjC selector: @- evaluateScript:withSourceURL:@
evaluateScript_withSourceURL :: (IsJSContext jsContext, IsNSString script, IsNSURL sourceURL) => jsContext -> script -> sourceURL -> IO (Id JSValue)
evaluateScript_withSourceURL jsContext  script sourceURL =
withObjCPtr script $ \raw_script ->
  withObjCPtr sourceURL $ \raw_sourceURL ->
      sendMsg jsContext (mkSelector "evaluateScript:withSourceURL:") (retPtr retVoid) [argPtr (castPtr raw_script :: Ptr ()), argPtr (castPtr raw_sourceURL :: Ptr ())] >>= retainedObject . castPtr

-- | Callback Accessors
--
-- Get the JSContext that is currently executing.
--
-- This method may be called from within an Objective-C block or method invoked as a callback from JavaScript to retrieve the callback's context. Outside of a callback from JavaScript this method will return nil.
--
-- Returns: The currently executing JSContext or nil if there isn't one.
--
-- ObjC selector: @+ currentContext@
currentContext :: IO (Id JSContext)
currentContext  =
  do
    cls' <- getRequiredClass "JSContext"
    sendClassMsg cls' (mkSelector "currentContext") (retPtr retVoid) [] >>= retainedObject . castPtr

-- | Get the JavaScript function that is currently executing.
--
-- This method may be called from within an Objective-C block or method invoked as a callback from JavaScript to retrieve the callback's context. Outside of a callback from JavaScript this method will return nil.
--
-- Returns: The currently executing JavaScript function or nil if there isn't one.
--
-- ObjC selector: @+ currentCallee@
currentCallee :: IO (Id JSValue)
currentCallee  =
  do
    cls' <- getRequiredClass "JSContext"
    sendClassMsg cls' (mkSelector "currentCallee") (retPtr retVoid) [] >>= retainedObject . castPtr

-- | Get the this value of the currently executing method.
--
-- This method may be called from within an Objective-C block or method invoked as a callback from JavaScript to retrieve the callback's this value. Outside of a callback from JavaScript this method will return nil.
--
-- Returns: The current this value or nil if there isn't one.
--
-- ObjC selector: @+ currentThis@
currentThis :: IO (Id JSValue)
currentThis  =
  do
    cls' <- getRequiredClass "JSContext"
    sendClassMsg cls' (mkSelector "currentThis") (retPtr retVoid) [] >>= retainedObject . castPtr

-- | Get the arguments to the current callback.
--
-- This method may be called from within an Objective-C block or method invoked as a callback from JavaScript to retrieve the callback's arguments, objects in the returned array are instances of JSValue. Outside of a callback from JavaScript this method will return nil.
--
-- Returns: An NSArray of the arguments nil if there is no current callback.
--
-- ObjC selector: @+ currentArguments@
currentArguments :: IO (Id NSArray)
currentArguments  =
  do
    cls' <- getRequiredClass "JSContext"
    sendClassMsg cls' (mkSelector "currentArguments") (retPtr retVoid) [] >>= retainedObject . castPtr

-- | Create a JSContext, wrapping its C API counterpart.
--
-- Returns: The JSContext equivalent of the provided JSGlobalContextRef.
--
-- ObjC selector: @+ contextWithJSGlobalContextRef:@
contextWithJSGlobalContextRef :: Ptr () -> IO (Id JSContext)
contextWithJSGlobalContextRef jsGlobalContextRef =
  do
    cls' <- getRequiredClass "JSContext"
    sendClassMsg cls' (mkSelector "contextWithJSGlobalContextRef:") (retPtr retVoid) [argPtr jsGlobalContextRef] >>= retainedObject . castPtr

-- | Get a particular property on the global object.
--
-- Returns: The JSValue for the global object's property.
--
-- ObjC selector: @- objectForKeyedSubscript:@
objectForKeyedSubscript :: IsJSContext jsContext => jsContext -> RawId -> IO (Id JSValue)
objectForKeyedSubscript jsContext  key =
  sendMsg jsContext (mkSelector "objectForKeyedSubscript:") (retPtr retVoid) [argPtr (castPtr (unRawId key) :: Ptr ())] >>= retainedObject . castPtr

-- | Set a particular property on the global object.
--
-- ObjC selector: @- setObject:forKeyedSubscript:@
setObject_forKeyedSubscript :: (IsJSContext jsContext, IsNSObject key) => jsContext -> RawId -> key -> IO ()
setObject_forKeyedSubscript jsContext  object key =
withObjCPtr key $ \raw_key ->
    sendMsg jsContext (mkSelector "setObject:forKeyedSubscript:") retVoid [argPtr (castPtr (unRawId object) :: Ptr ()), argPtr (castPtr raw_key :: Ptr ())]

-- | Get the global object of the context.
--
-- This method retrieves the global object of the JavaScript execution context. Instances of JSContext originating from WebKit will return a reference to the WindowProxy object.
--
-- Returns: The global object.
--
-- ObjC selector: @- globalObject@
globalObject :: IsJSContext jsContext => jsContext -> IO (Id JSValue)
globalObject jsContext  =
  sendMsg jsContext (mkSelector "globalObject") (retPtr retVoid) [] >>= retainedObject . castPtr

-- | The exception property may be used to throw an exception to JavaScript.
--
-- Before a callback is made from JavaScript to an Objective-C block or method, the prior value of the exception property will be preserved and the property will be set to nil. After the callback has completed the new value of the exception property will be read, and prior value restored. If the new value of exception is not nil, the callback will result in that value being thrown.
--
-- This property may also be used to check for uncaught exceptions arising from API function calls (since the default behaviour of exceptionHandler is to assign an uncaught exception to this property).
--
-- ObjC selector: @- exception@
exception :: IsJSContext jsContext => jsContext -> IO (Id JSValue)
exception jsContext  =
  sendMsg jsContext (mkSelector "exception") (retPtr retVoid) [] >>= retainedObject . castPtr

-- | The exception property may be used to throw an exception to JavaScript.
--
-- Before a callback is made from JavaScript to an Objective-C block or method, the prior value of the exception property will be preserved and the property will be set to nil. After the callback has completed the new value of the exception property will be read, and prior value restored. If the new value of exception is not nil, the callback will result in that value being thrown.
--
-- This property may also be used to check for uncaught exceptions arising from API function calls (since the default behaviour of exceptionHandler is to assign an uncaught exception to this property).
--
-- ObjC selector: @- setException:@
setException :: (IsJSContext jsContext, IsJSValue value) => jsContext -> value -> IO ()
setException jsContext  value =
withObjCPtr value $ \raw_value ->
    sendMsg jsContext (mkSelector "setException:") retVoid [argPtr (castPtr raw_value :: Ptr ())]

-- | If a call to an API function results in an uncaught JavaScript exception, the exceptionHandler block will be invoked. The default implementation for the exception handler will store the exception to the exception property on context. As a consequence the default behaviour is for uncaught exceptions occurring within a callback from JavaScript to be rethrown upon return. Setting this value to nil will cause all exceptions occurring within a callback from JavaScript to be silently caught.
--
-- ObjC selector: @- exceptionHandler@
exceptionHandler :: IsJSContext jsContext => jsContext -> IO (Ptr ())
exceptionHandler jsContext  =
  fmap castPtr $ sendMsg jsContext (mkSelector "exceptionHandler") (retPtr retVoid) []

-- | If a call to an API function results in an uncaught JavaScript exception, the exceptionHandler block will be invoked. The default implementation for the exception handler will store the exception to the exception property on context. As a consequence the default behaviour is for uncaught exceptions occurring within a callback from JavaScript to be rethrown upon return. Setting this value to nil will cause all exceptions occurring within a callback from JavaScript to be silently caught.
--
-- ObjC selector: @- setExceptionHandler:@
setExceptionHandler :: IsJSContext jsContext => jsContext -> Ptr () -> IO ()
setExceptionHandler jsContext  value =
  sendMsg jsContext (mkSelector "setExceptionHandler:") retVoid [argPtr (castPtr value :: Ptr ())]

-- | All instances of JSContext are associated with a JSVirtualMachine.
--
-- ObjC selector: @- virtualMachine@
virtualMachine :: IsJSContext jsContext => jsContext -> IO (Id JSVirtualMachine)
virtualMachine jsContext  =
  sendMsg jsContext (mkSelector "virtualMachine") (retPtr retVoid) [] >>= retainedObject . castPtr

-- | Name of the JSContext. Exposed when inspecting the context.
--
-- ObjC selector: @- name@
name :: IsJSContext jsContext => jsContext -> IO (Id NSString)
name jsContext  =
  sendMsg jsContext (mkSelector "name") (retPtr retVoid) [] >>= retainedObject . castPtr

-- | Name of the JSContext. Exposed when inspecting the context.
--
-- ObjC selector: @- setName:@
setName :: (IsJSContext jsContext, IsNSString value) => jsContext -> value -> IO ()
setName jsContext  value =
withObjCPtr value $ \raw_value ->
    sendMsg jsContext (mkSelector "setName:") retVoid [argPtr (castPtr raw_value :: Ptr ())]

-- | Controls whether this
--
-- JSContext
--
-- is inspectable in Web Inspector. The default value is NO.
--
-- ObjC selector: @- inspectable@
inspectable :: IsJSContext jsContext => jsContext -> IO Bool
inspectable jsContext  =
  fmap ((/= 0) :: CULong -> Bool) $ sendMsg jsContext (mkSelector "inspectable") retCULong []

-- | Controls whether this
--
-- JSContext
--
-- is inspectable in Web Inspector. The default value is NO.
--
-- ObjC selector: @- setInspectable:@
setInspectable :: IsJSContext jsContext => jsContext -> Bool -> IO ()
setInspectable jsContext  value =
  sendMsg jsContext (mkSelector "setInspectable:") retVoid [argCULong (if value then 1 else 0)]

-- | Get the C API counterpart wrapped by a JSContext.
--
-- Returns: The C API equivalent of this JSContext.
--
-- ObjC selector: @- JSGlobalContextRef@
jsGlobalContextRef :: IsJSContext jsContext => jsContext -> IO (Ptr ())
jsGlobalContextRef jsContext  =
  fmap castPtr $ sendMsg jsContext (mkSelector "JSGlobalContextRef") (retPtr retVoid) []

-- ---------------------------------------------------------------------------
-- Selectors
-- ---------------------------------------------------------------------------

-- | @Selector@ for @init@
initSelector :: Selector
initSelector = mkSelector "init"

-- | @Selector@ for @initWithVirtualMachine:@
initWithVirtualMachineSelector :: Selector
initWithVirtualMachineSelector = mkSelector "initWithVirtualMachine:"

-- | @Selector@ for @evaluateScript:@
evaluateScriptSelector :: Selector
evaluateScriptSelector = mkSelector "evaluateScript:"

-- | @Selector@ for @evaluateScript:withSourceURL:@
evaluateScript_withSourceURLSelector :: Selector
evaluateScript_withSourceURLSelector = mkSelector "evaluateScript:withSourceURL:"

-- | @Selector@ for @currentContext@
currentContextSelector :: Selector
currentContextSelector = mkSelector "currentContext"

-- | @Selector@ for @currentCallee@
currentCalleeSelector :: Selector
currentCalleeSelector = mkSelector "currentCallee"

-- | @Selector@ for @currentThis@
currentThisSelector :: Selector
currentThisSelector = mkSelector "currentThis"

-- | @Selector@ for @currentArguments@
currentArgumentsSelector :: Selector
currentArgumentsSelector = mkSelector "currentArguments"

-- | @Selector@ for @contextWithJSGlobalContextRef:@
contextWithJSGlobalContextRefSelector :: Selector
contextWithJSGlobalContextRefSelector = mkSelector "contextWithJSGlobalContextRef:"

-- | @Selector@ for @objectForKeyedSubscript:@
objectForKeyedSubscriptSelector :: Selector
objectForKeyedSubscriptSelector = mkSelector "objectForKeyedSubscript:"

-- | @Selector@ for @setObject:forKeyedSubscript:@
setObject_forKeyedSubscriptSelector :: Selector
setObject_forKeyedSubscriptSelector = mkSelector "setObject:forKeyedSubscript:"

-- | @Selector@ for @globalObject@
globalObjectSelector :: Selector
globalObjectSelector = mkSelector "globalObject"

-- | @Selector@ for @exception@
exceptionSelector :: Selector
exceptionSelector = mkSelector "exception"

-- | @Selector@ for @setException:@
setExceptionSelector :: Selector
setExceptionSelector = mkSelector "setException:"

-- | @Selector@ for @exceptionHandler@
exceptionHandlerSelector :: Selector
exceptionHandlerSelector = mkSelector "exceptionHandler"

-- | @Selector@ for @setExceptionHandler:@
setExceptionHandlerSelector :: Selector
setExceptionHandlerSelector = mkSelector "setExceptionHandler:"

-- | @Selector@ for @virtualMachine@
virtualMachineSelector :: Selector
virtualMachineSelector = mkSelector "virtualMachine"

-- | @Selector@ for @name@
nameSelector :: Selector
nameSelector = mkSelector "name"

-- | @Selector@ for @setName:@
setNameSelector :: Selector
setNameSelector = mkSelector "setName:"

-- | @Selector@ for @inspectable@
inspectableSelector :: Selector
inspectableSelector = mkSelector "inspectable"

-- | @Selector@ for @setInspectable:@
setInspectableSelector :: Selector
setInspectableSelector = mkSelector "setInspectable:"

-- | @Selector@ for @JSGlobalContextRef@
jsGlobalContextRefSelector :: Selector
jsGlobalContextRefSelector = mkSelector "JSGlobalContextRef"

