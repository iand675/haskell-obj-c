{-# LANGUAGE PatternSynonyms #-}
{-# LANGUAGE TypeApplications #-}
{-# LANGUAGE ScopedTypeVariables #-}
{-# LANGUAGE FlexibleContexts #-}

-- | NEVPNConnection
--
-- The NEVPNConnection class declares the programmatic interface for an object that manages VPN connections.
--
-- Instances of this class are thread safe.
--
-- Generated bindings for @NEVPNConnection@.
module ObjC.NetworkExtension.NEVPNConnection
  ( NEVPNConnection
  , IsNEVPNConnection(..)
  , startVPNTunnelAndReturnError
  , startVPNTunnelWithOptions_andReturnError
  , stopVPNTunnel
  , fetchLastDisconnectErrorWithCompletionHandler
  , status
  , startVPNTunnelAndReturnErrorSelector
  , startVPNTunnelWithOptions_andReturnErrorSelector
  , stopVPNTunnelSelector
  , fetchLastDisconnectErrorWithCompletionHandlerSelector
  , statusSelector

  -- * Enum types
  , NEVPNStatus(NEVPNStatus)
  , pattern NEVPNStatusInvalid
  , pattern NEVPNStatusDisconnected
  , pattern NEVPNStatusConnecting
  , pattern NEVPNStatusConnected
  , pattern NEVPNStatusReasserting
  , pattern NEVPNStatusDisconnecting

  ) where

import Foreign.Ptr (Ptr, nullPtr, castPtr)
import Foreign.LibFFI
import Foreign.C.Types
import Data.Int (Int8, Int16)
import Data.Word (Word16)
import Data.Coerce (coerce)

import ObjC.Runtime.Types
import ObjC.Runtime.MsgSend (sendMsg, sendClassMsg)
import ObjC.Runtime.Selector (mkSelector)
import ObjC.Runtime.Class (getRequiredClass)

import ObjC.NetworkExtension.Internal.Classes
import ObjC.NetworkExtension.Internal.Enums
import ObjC.Foundation.Internal.Classes

-- | startVPNTunnelAndReturnError:
--
-- This function is used to start the VPN tunnel using the current VPN configuration. The VPN tunnel connection process is started and this function returns immediately.
--
-- @error@ — If the VPN tunnel was started successfully, this parameter is set to nil. Otherwise this parameter is set to the error that occurred. Possible errors include:    1. NEVPNErrorConfigurationInvalid    2. NEVPNErrorConfigurationDisabled
--
-- Returns: YES if the VPN tunnel was started successfully, NO if an error occurred.
--
-- ObjC selector: @- startVPNTunnelAndReturnError:@
startVPNTunnelAndReturnError :: (IsNEVPNConnection nevpnConnection, IsNSError error_) => nevpnConnection -> error_ -> IO Bool
startVPNTunnelAndReturnError nevpnConnection  error_ =
withObjCPtr error_ $ \raw_error_ ->
    fmap ((/= 0) :: CULong -> Bool) $ sendMsg nevpnConnection (mkSelector "startVPNTunnelAndReturnError:") retCULong [argPtr (castPtr raw_error_ :: Ptr ())]

-- | startVPNTunnelWithOptions:andReturnError:
--
-- This function is used to start the VPN tunnel using the current VPN configuration. The VPN tunnel connection process is started and this function returns immediately.
--
-- @options@ — A dictionary that will be passed to the tunnel provider during the process of starting the tunnel.    If not nil, 'options' is an NSDictionary may contain the following keys        NEVPNConnectionStartOptionUsername        NEVPNConnectionStartOptionPassword
--
-- @error@ — If the VPN tunnel was started successfully, this parameter is set to nil. Otherwise this parameter is set to the error that occurred. Possible errors include:    1. NEVPNErrorConfigurationInvalid    2. NEVPNErrorConfigurationDisabled
--
-- Returns: YES if the VPN tunnel was started successfully, NO if an error occurred.
--
-- ObjC selector: @- startVPNTunnelWithOptions:andReturnError:@
startVPNTunnelWithOptions_andReturnError :: (IsNEVPNConnection nevpnConnection, IsNSDictionary options, IsNSError error_) => nevpnConnection -> options -> error_ -> IO Bool
startVPNTunnelWithOptions_andReturnError nevpnConnection  options error_ =
withObjCPtr options $ \raw_options ->
  withObjCPtr error_ $ \raw_error_ ->
      fmap ((/= 0) :: CULong -> Bool) $ sendMsg nevpnConnection (mkSelector "startVPNTunnelWithOptions:andReturnError:") retCULong [argPtr (castPtr raw_options :: Ptr ()), argPtr (castPtr raw_error_ :: Ptr ())]

-- | stopVPNTunnel:
--
-- This function is used to stop the VPN tunnel. The VPN tunnel disconnect process is started and this function returns immediately.
--
-- ObjC selector: @- stopVPNTunnel@
stopVPNTunnel :: IsNEVPNConnection nevpnConnection => nevpnConnection -> IO ()
stopVPNTunnel nevpnConnection  =
  sendMsg nevpnConnection (mkSelector "stopVPNTunnel") retVoid []

-- | fetchLastDisconnectErrorWithCompletionHandler:
--
-- Retrive the most recent error that caused the VPN to disconnect. If the error was generated by the VPN system (including the IPsec client) then the error will be in the NEVPNConnectionErrorDomain error domain. If the error was generated by a tunnel provider app extension then the error will be the NSError that the provider passed when disconnecting the tunnel.
--
-- @handler@ — A block which takes an optional NSError that will be called when the error is obtained.
--
-- ObjC selector: @- fetchLastDisconnectErrorWithCompletionHandler:@
fetchLastDisconnectErrorWithCompletionHandler :: IsNEVPNConnection nevpnConnection => nevpnConnection -> Ptr () -> IO ()
fetchLastDisconnectErrorWithCompletionHandler nevpnConnection  handler =
  sendMsg nevpnConnection (mkSelector "fetchLastDisconnectErrorWithCompletionHandler:") retVoid [argPtr (castPtr handler :: Ptr ())]

-- | status
--
-- The current status of the VPN.
--
-- ObjC selector: @- status@
status :: IsNEVPNConnection nevpnConnection => nevpnConnection -> IO NEVPNStatus
status nevpnConnection  =
  fmap (coerce :: CLong -> NEVPNStatus) $ sendMsg nevpnConnection (mkSelector "status") retCLong []

-- ---------------------------------------------------------------------------
-- Selectors
-- ---------------------------------------------------------------------------

-- | @Selector@ for @startVPNTunnelAndReturnError:@
startVPNTunnelAndReturnErrorSelector :: Selector
startVPNTunnelAndReturnErrorSelector = mkSelector "startVPNTunnelAndReturnError:"

-- | @Selector@ for @startVPNTunnelWithOptions:andReturnError:@
startVPNTunnelWithOptions_andReturnErrorSelector :: Selector
startVPNTunnelWithOptions_andReturnErrorSelector = mkSelector "startVPNTunnelWithOptions:andReturnError:"

-- | @Selector@ for @stopVPNTunnel@
stopVPNTunnelSelector :: Selector
stopVPNTunnelSelector = mkSelector "stopVPNTunnel"

-- | @Selector@ for @fetchLastDisconnectErrorWithCompletionHandler:@
fetchLastDisconnectErrorWithCompletionHandlerSelector :: Selector
fetchLastDisconnectErrorWithCompletionHandlerSelector = mkSelector "fetchLastDisconnectErrorWithCompletionHandler:"

-- | @Selector@ for @status@
statusSelector :: Selector
statusSelector = mkSelector "status"

